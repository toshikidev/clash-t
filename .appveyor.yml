version: '{branch}-{build}'

# Do not build on tags (GitHub only)
skip_tags: true

image: Visual Studio 2022

branches:
  except:  # blacklist
    - coverity_scan

environment:
  REPO_DIR: &REPO_DIR c:\clash-t

# project directory
clone_folder: *REPO_DIR

# clone_depth: 50

install:
  - cd "%REPO_DIR%"
  - dotnet --info

build_script:
  - cd "%REPO_DIR%"
  - dotnet build clashT -o build

after_build:
  - cd "%REPO_DIR%\build"
  - MKDIR upload
  - ls -a
  - COPY "%REPO_DIR%\build" upload
  - COPY "%REPO_DIR%\build\de\Microsoft.Win32.TaskScheduler.resources.dll" upload
  - COPY "%REPO_DIR%\build\es\Microsoft.Win32.TaskScheduler.resources.dll" upload
  - COPY "%REPO_DIR%\build\fa-IR\clashT.resources.dll" upload
  - COPY "%REPO_DIR%\build\fr\Microsoft.Win32.TaskScheduler.resources.dll" upload
  - COPY "%REPO_DIR%\build\it\Microsoft.Win32.TaskScheduler.resources.dll" upload
  - COPY "%REPO_DIR%\build\pl\Microsoft.Win32.TaskScheduler.resources.dll" upload
  - COPY "%REPO_DIR%\build\Resources\Fonts\MiSans-Regular.ttf" upload
  - COPY "%REPO_DIR%\build\ru\Microsoft.Win32.TaskScheduler.resources.dll" upload
  - COPY "%REPO_DIR%\build\zh-CN\Microsoft.Win32.TaskScheduler.resources.dll" upload
  - COPY "%REPO_DIR%\build\zh-Hans\clashT.resources.dll" upload
  - COPY "%REPO_DIR%\build\zh-Hant\Microsoft.Win32.TaskScheduler.resources.dll" upload

test: off

artifacts:
  - path: \build\upload
    name: clash-t-appveyor-windows-x64